<VirtualHost *:80>
	RewriteEngine on
	RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName FRONTEND
        ServerAlias www.FRONTEND

        ServerAdmin security@yourdomain.com
        DocumentRoot /var/www/app/frontend/web

        LogFormat "%t %v %h %l %u \"%r\" %>s %b \"%{Referer}i\" %T %D %X" LG_extended
        ErrorLog /var/www/app/common/uploads/error.log
        CustomLog /var/www/app/common/uploads/access.log LG_extended

		Include extra/ssl.conf

        <Location /Shibboleth.sso>
            ShibRequestSetting applicationId frontend
            AuthType shibboleth
            ShibRequireSession On
            ShibUseHeaders On
            require shibboleth
        </Location>

        <Location /socialauth/shibboleth>
            ShibRequestSetting applicationId frontend
            AuthType shibboleth
            ShibRequireSession On
            ShibUseHeaders On
            require shibboleth
        </Location>

		Include extra/shibboleth.conf

        <Directory /var/www/app/frontend/web>
            Options FollowSymLinks
            AllowOverride All
        </Directory>
    </VirtualHost>
    <VirtualHost *:443>
        ServerName BACKEND
        ServerAlias www.BACKEND

        ServerAdmin security@yourdomain.com
        DocumentRoot /var/www/app/backend/web

        LogFormat "%t %v %h %l %u \"%r\" %>s %b \"%{Referer}i\" %T %D %X" LG_extended
        ErrorLog /var/www/app/common/uploads/error.log
        CustomLog /var/www/app/common/uploads/access.log LG_extended

		Include extra/ssl.conf

        <Location /Shibboleth.sso>
            ShibRequestSetting applicationId backend
            AuthType shibboleth
            ShibRequireSession On
            ShibUseHeaders On
            require shibboleth
        </Location>

        <Location /socialauth/shibboleth>
            ShibRequestSetting applicationId backend
            AuthType shibboleth
            ShibRequireSession On
            ShibUseHeaders On
            require shibboleth
        </Location>

		Include extra/shibboleth.conf

        <Directory /var/www/app/backend/web>
            Options FollowSymLinks
            AllowOverride All
        </Directory>
    </VirtualHost>
    <VirtualHost *:443>
        ServerName www2.BACKEND

        ServerAdmin security@yourdomain.com
        DocumentRoot /var/www/app/backend/web

        LogFormat "%t %v %V %h %l %u \"%r\" %>s %b \"%{Referer}i\" %T %D %X" LG_extended
        ErrorLog /var/www/app/common/uploads/www2_error.log
        CustomLog /var/www/app/common/uploads/www2_access.log LG_extended

        RequestHeader set "Host" "BACKEND"

        <Directory /var/www/app/backend/web>
            Options FollowSymLinks
            AllowOverride All
        </Directory>

		Include extra/ssl.conf
    </VirtualHost>
    <VirtualHost *:443>
        ServerName www2.FRONTEND

        ServerAdmin security@yourdomain.com
        DocumentRoot /var/www/app/frontend/web

        LogFormat "%t %v %V %h %l %u \"%r\" %>s %b \"%{Referer}i\" %T %D %X" LG_extended
        ErrorLog /var/www/app/common/uploads/www2_error.log
        CustomLog /var/www/app/common/uploads/www2_access.log LG_extended

        RequestHeader set "Host" "FRONTEND"

        <Directory /var/www/app/frontend/web>
            Options FollowSymLinks
            AllowOverride All
        </Directory>

		Include extra/ssl.conf
    </VirtualHost>
</IfModule>